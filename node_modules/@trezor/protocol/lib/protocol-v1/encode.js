"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.encode = void 0;
const constants_1 = require("./constants");
const encode = (data, options) => {
    const { messageType } = options;
    const fullSize = constants_1.HEADER_SIZE + data.length;
    const chunkSize = options.chunkSize || constants_1.BUFFER_SIZE;
    const encodedBuffer = Buffer.alloc(fullSize);
    encodedBuffer.writeUInt8(constants_1.MESSAGE_HEADER_BYTE, 0);
    encodedBuffer.writeUInt8(constants_1.MESSAGE_HEADER_BYTE, 1);
    encodedBuffer.writeUInt16BE(messageType, 2);
    encodedBuffer.writeUInt32BE(data.length, 4);
    data.copy(encodedBuffer, constants_1.HEADER_SIZE);
    const size = chunkSize - 1;
    const chunkCount = Math.ceil(encodedBuffer.length / size) || 1;
    const result = [];
    for (let i = 0; i < chunkCount; i++) {
        const start = i * size;
        const end = Math.min((i + 1) * size, encodedBuffer.length);
        const buffer = Buffer.alloc(chunkSize);
        buffer.writeUInt8(constants_1.MESSAGE_MAGIC_HEADER_BYTE);
        encodedBuffer.copy(buffer, 1, start, end);
        result.push(buffer);
    }
    return result;
};
exports.encode = encode;
//# sourceMappingURL=encode.js.map